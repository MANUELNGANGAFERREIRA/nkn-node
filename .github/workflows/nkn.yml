name: NKN Node com Binário Comercial

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  nkn:
    runs-on: ubuntu-latest

    steps:
      - name: Instalar dependências
        run: sudo apt update && sudo apt install unzip -y

      - name: Baixar binário comercial do NKN
        run: |
          set -eux
          curl -fL https://commercial.nkn.org/downloads/nkn-commercial/linux-amd64.zip -o nkn.zip
          unzip -o nkn.zip
          ls -lh linux-amd64/
          for bin in nknd nknc nkn-commercial; do
            if [ ! -f "linux-amd64/$bin" ]; then
              echo "Erro: $bin não encontrado após o unzip"
              exit 1
            fi
          done
          chmod +x linux-amd64/nknd linux-amd64/nknc linux-amd64/nkn-commercial
          mv linux-amd64/* .

      - name: Criar config.json
        run: |
          mkdir -p ~/.nkn
          echo '{ "BeneficiaryAddr": "NKNaMFPovvDXo3M3XuRKbKgTEjKUqegjSD9z" }' > ~/.nkn/config.json

      - name: Iniciar o NKN Node
        run: |
          ./nknd --no-nat --syncmode fast --logtostderr &
          while sleep 300; do echo "Node ativo..."; done
